# GSC 地域キーワード分析 - 説明書

## 目次

1. [セットアップ手順](#1-セットアップ手順)
2. [出力シート一覧](#2-出力シート一覧)
3. [サマリー](#3-サマリー)
4. [都道府県別分析](#4-都道府県別分析)
5. [地方別分析](#5-地方別分析)
6. [地域KW一覧](#6-地域kw一覧)
7. [チャンスKW](#7-チャンスkw)
8. [低CTR改善KW](#8-低ctr改善kw)
9. [未カバー地域](#9-未カバー地域)
10. [順位帯別分布](#10-順位帯別分布)
11. [地域×サービス マトリクス](#11-地域サービス-マトリクス)
12. [設定シート](#12-設定シート)
13. [用語解説](#13-用語解説)
14. [分析結果の活用方法](#14-分析結果の活用方法)
15. [注意事項と制限](#15-注意事項と制限)

---

## 1. セットアップ手順

### 1-1. データの準備

1. Google Search Console にログイン
2. 「検索パフォーマンス」レポートを開く
3. 期間を設定する（推奨: 過去3ヶ月 or 過去28日間）
4. 右上の「エクスポート」→「Google スプレッドシート」を選択
5. スプレッドシートが自動で開く（「クエリ」タブにデータが入っている）

### 1-2. スクリプトの導入

1. エクスポートしたスプレッドシートを開く
2. メニューから「拡張機能」→「Apps Script」を選択
3. エディタが開いたら、既存のコードをすべて削除
4. `Code.gs` の内容をすべて貼り付けて保存（Ctrl+S）
5. スプレッドシートのタブに戻り、ページをリロード
6. メニューに「地域KW分析」が表示される

### 1-3. 初回実行

1. メニュー「地域KW分析」→「分析を実行」をクリック
2. 初回はGoogleの認証画面が表示されるので「許可」を選択
3. 分析が完了すると、各シートが自動で作成される

### 1-4. 地域×サービス分析を使う場合（任意）

1. メニュー「地域KW分析」→「設定シートを作成」をクリック
2. 「設定」シートが作られるので、自社のサービスキーワードを編集
3. 再度「分析を実行」すると、マトリクス分析が追加される

---

## 2. 出力シート一覧

分析を実行すると、以下のシートが自動作成されます。

| # | シート名 | 概要 | 主な用途 |
|---|---------|------|---------|
| 1 | サマリー | 全体概要のダッシュボード | 現状把握、報告用 |
| 2 | 都道府県別分析 | 47都道府県ごとの詳細指標 | 地域別の強み・弱みの把握 |
| 3 | 地方別分析 | 7地方ブロック別の集計 | エリア戦略の大枠を検討 |
| 4 | 地域KW一覧 | 地域と判定された全キーワード | マッチング精度の確認、個別KWの分析 |
| 5 | チャンスKW | 改善すると大きなリターンが見込めるKW | コンテンツ改善の優先順位付け |
| 6 | 低CTR改善KW | 順位の割にクリックされていないKW | タイトル・メタディスクリプションの改善 |
| 7 | 未カバー地域 | KWが存在しない・少ない地域 | 新規コンテンツ作成の計画 |
| 8 | 順位帯別分布 | 都道府県×順位帯のクロス集計 | 各地域の検索順位の全体感を把握 |
| 9 | 地域×サービス | 都道府県×サービスKWのマトリクス | サービス軸で手薄な地域を発見 |

---

## 3. サマリー

全体の概要を1シートにまとめたダッシュボードです。

### 出力項目

#### 全体概要

| 項目 | 説明 |
|------|------|
| **総キーワード数** | GSCから取得した全クエリの数。GSC標準では上位1,000件が上限。 |
| **地域キーワード数** | 都道府県名または主要都市名を含むと判定されたクエリの数。 |
| **非地域キーワード数** | 地域名を含まないクエリの数。 |
| **地域キーワード比率** | `地域KW数 ÷ 総KW数`。地域系の検索がどの程度を占めるかの指標。 |

#### パフォーマンス比較

「全体」と「地域KWのみ」の値を並べて比較します。

| 項目 | 説明 |
|------|------|
| **クリック数合計** | 検索結果からサイトがクリックされた合計回数。 |
| **表示回数合計** | 検索結果にサイトが表示された合計回数。 |
| **平均掲載順位（単純平均）** | 全KWの順位を単純に平均した値。KW数が多い地域の影響を均等に見る場合に使用。 |
| **平均掲載順位（表示回数加重）** | 表示回数で重み付けした平均順位。表示が多いKW（＝ユーザーの目に触れやすいKW）の順位がより強く反映される。**実際の検索体験に近い指標。** |

#### 都道府県カバレッジ

| 項目 | 説明 |
|------|------|
| **カバー済み都道府県数** | 1つ以上のKWがマッチした都道府県の数。 |
| **未カバー都道府県数** | KWが0件の都道府県の数。 |
| **カバー率** | `カバー済み ÷ 47`。全国展開を目指す場合の進捗指標。 |

### 読み方のポイント

- **地域KW比率が低い場合**: 地域名を含むコンテンツが少ない。地域ページの作成を検討。
- **地域KWの加重平均順位が全体より悪い場合**: 地域系コンテンツの質や被リンクが弱い。
- **カバー率が低い場合**: 対象エリアに対してコンテンツが不足している。

---

## 4. 都道府県別分析

47都道府県それぞれについて、詳細なパフォーマンス指標を表示します。
キーワード数の多い順にソートされています。

### 出力カラム

| カラム | 説明 |
|--------|------|
| **都道府県** | 47都道府県名 |
| **キーワード数** | その都道府県に分類されたKWの数 |
| **クリック数合計** | その都道府県のKWが獲得したクリック数の合計 |
| **表示回数合計** | その都道府県のKWの表示回数の合計 |
| **平均CTR** | `クリック数合計 ÷ 表示回数合計`。その地域のKWがどの程度クリックされているか。 |
| **平均順位（単純）** | その都道府県のKWの順位を単純平均した値。 |
| **平均順位（加重）** | 表示回数で重み付けした平均順位。**表示が多いKWの順位をより反映。** |
| **Top3内KW数** | 掲載順位が3位以内のKWの数。検索結果の最上部に表示される。 |
| **Top10内KW数** | 掲載順位が10位以内（1ページ目）のKWの数。 |
| **順位10以下KW数** | 掲載順位が11位以下（2ページ目以降）のKWの数。改善の余地あり。 |

### 2つの平均順位の違い

| 指標 | 計算方法 | 用途 |
|------|---------|------|
| **単純平均** | `(順位1 + 順位2 + ... + 順位N) ÷ N` | キーワード1つ1つを等しく重視。ニッチKWの状況も把握したい場合。 |
| **加重平均** | `Σ(順位 × 表示回数) ÷ Σ(表示回数)` | 表示回数の多いKWほど重みが大きい。**実際のユーザー体験に近い**。 |

例えば、ある県に以下の2KWがある場合:
- 「東京 加工」: 順位 2.0、表示回数 5,000
- 「東京 サービス」: 順位 30.0、表示回数 10

単純平均 = (2 + 30) / 2 = **16.0** → 悪く見える
加重平均 = (2×5000 + 30×10) / 5010 = **2.06** → 実態に近い

### 読み方のポイント

- **KW数が多い＝強い地域**: その地域に関連するページが多く検索にヒットしている。
- **KW数が0の都道府県**: その地域向けのコンテンツが存在しないか、SEOが効いていない。
- **Top3内が多い県**: 既に強いポジションを持っている。維持しつつ他地域に展開。
- **順位10以下が多い県**: 2ページ目以降に沈んでいるKWが多い。コンテンツ改善で順位向上の余地。

---

## 5. 地方別分析

47都道府県を7つの地方ブロックに集約した分析です。

### 地方区分

| 地方 | 含まれる都道府県 |
|------|----------------|
| 北海道・東北 | 北海道, 青森, 岩手, 宮城, 秋田, 山形, 福島 |
| 関東 | 茨城, 栃木, 群馬, 埼玉, 千葉, 東京, 神奈川 |
| 中部 | 新潟, 富山, 石川, 福井, 山梨, 長野, 岐阜, 静岡, 愛知 |
| 近畿 | 三重, 滋賀, 京都, 大阪, 兵庫, 奈良, 和歌山 |
| 中国 | 鳥取, 島根, 岡山, 広島, 山口 |
| 四国 | 徳島, 香川, 愛媛, 高知 |
| 九州・沖縄 | 福岡, 佐賀, 長崎, 熊本, 大分, 宮崎, 鹿児島, 沖縄 |

### 出力カラム

| カラム | 説明 |
|--------|------|
| **地方** | 地方ブロック名 |
| **キーワード数** | その地方に属する全KWの数（重複排除済み） |
| **クリック数合計** | 地方内KWのクリック合計 |
| **表示回数合計** | 地方内KWの表示回数合計 |
| **平均CTR** | 地方全体のCTR |
| **平均順位（加重）** | 表示回数で重み付けした地方全体の平均順位 |
| **含まれる都道府県** | その地方内でKWが1件以上ある都道府県名 |

### 読み方のポイント

- **KW数 0の地方**: その地方向けのコンテンツが全くない。ビジネスの対象エリアであれば最優先で対応。
- **「含まれる都道府県」が少ない地方**: 地方内の一部の県にしか対応できていない。横展開の余地。
- 全国対応のサービスなら、7地方すべてにバランスよくKWがあるのが理想。

---

## 6. 地域KW一覧

地域名を含むと判定された全キーワードの詳細一覧です。
クリック数の多い順にソートされています。

### 出力カラム

| カラム | 説明 |
|--------|------|
| **クエリ** | ユーザーが検索したキーワード |
| **クリック数** | そのKWで検索結果からクリックされた回数 |
| **表示回数** | そのKWで検索結果に表示された回数 |
| **CTR** | `クリック数 ÷ 表示回数` |
| **掲載順位** | そのKWでの平均掲載順位（1が最上位） |
| **該当都道府県** | マッチした都道府県名（複数の場合カンマ区切り） |
| **マッチキーワード** | 都道府県の判定に使われた文字列（県名、市名など） |

### 読み方のポイント

- **マッチキーワード列の確認**: 誤判定がないかチェック。例えば「日立製作所」が茨城県の「日立」にマッチしている場合など。
- **複数都道府県にマッチするKW**: 「東京 大阪 比較」のようなクエリは両方にカウントされる。
- このシートは**マッチング精度の検証用**としても使える。

---

## 7. チャンスKW

**改善すれば大きなリターンが見込めるキーワード**を自動抽出します。

### 抽出条件

以下の**両方**を満たすキーワード:
- 掲載順位が **11位以下**（2ページ目以降）
- 表示回数が **10回以上**

### 出力カラム

| カラム | 説明 |
|--------|------|
| **クエリ** | キーワード |
| **クリック数** | 現在のクリック数 |
| **表示回数** | 現在の表示回数（需要の大きさ） |
| **CTR** | 現在のCTR |
| **掲載順位** | 現在の平均順位 |
| **都道府県** | 該当する都道府県 |
| **チャンススコア** | 改善インパクトの推定スコア |

### チャンススコアの計算方法

```
チャンススコア = 表示回数 × (現在の順位 - 3)
```

- 目標順位を3位（検索結果の上位表示）と設定
- 現在の順位が目標から遠いほど、かつ表示回数が多いほどスコアが高くなる
- **スコアが高い＝改善した場合のインパクトが大きい**

### 例

| クエリ | 表示回数 | 順位 | スコア | 解釈 |
|--------|---------|------|--------|------|
| 「東京 加工」 | 500 | 15.0 | 6,000 | 需要大＆順位改善余地大 → 最優先 |
| 「大阪 切断」 | 100 | 25.0 | 2,200 | 中程度の需要だが順位が低い |
| 「福岡 加工」 | 20 | 12.0 | 180 | 需要小＆順位もやや低い |

### 読み方のポイント

- **スコア上位から優先的に対応**: 限られたリソースで最大効果を狙う。
- **表示回数が多いのに順位が低い**: 検索需要はあるが、コンテンツが弱い or 存在しない。
- 対策例: 該当地域の専用ページ作成、既存ページの地域情報追加、内部リンク強化。

---

## 8. 低CTR改善KW

**順位は良いのにクリックされていないキーワード**を抽出します。
タイトルタグやメタディスクリプションの改善で即効性のある対策が可能です。

### 抽出条件

以下の**すべて**を満たすキーワード:
- 掲載順位が **10位以内**（1ページ目）
- 表示回数が **10回以上**
- 実際のCTRが**順位から期待されるCTR（ベンチマーク）より2%以上低い**

### CTRベンチマーク（業界平均目安）

スクリプトでは以下の値を基準としています:

| 順位帯 | 期待CTR | 根拠 |
|--------|--------|------|
| 1位 | 30% | 検索結果の最上位。最もクリックされる。 |
| 2位 | 15% | 1位の約半分。 |
| 3位 | 10% | トップ3は視認性が高い。 |
| 4〜5位 | 5% | ファーストビューぎりぎり。 |
| 6〜10位 | 2% | スクロールが必要。 |

### 出力カラム

| カラム | 説明 |
|--------|------|
| **クエリ** | キーワード |
| **クリック数** | 現在のクリック数 |
| **表示回数** | 現在の表示回数 |
| **CTR** | 実際のCTR |
| **掲載順位** | 現在の平均順位 |
| **地域KW** | 地域キーワードかどうか（はい/いいえ） |
| **都道府県** | 地域KWの場合、該当する都道府県 |
| **想定CTRとの差** | `実際CTR - 期待CTR`。マイナスが大きいほど改善余地が大きい。 |

### 読み方のポイント

- **想定CTRとの差がマイナスの大きいKW**: タイトル・ディスクリプションがユーザーの検索意図と合っていない可能性。
- **対策例**:
  - タイトルタグにキーワードや地域名を含める
  - メタディスクリプションに具体的なメリットや差別化ポイントを記載
  - 構造化データ（リッチリザルト）の追加
- このシートには地域KW以外も含まれる（全KWが対象）。

---

## 9. 未カバー地域

47都道府県の**カバー状況**を一覧表示します。
コンテンツが不足している地域を発見するためのシートです。

### ステータスの定義

| ステータス | 条件 | 背景色 | 意味 |
|-----------|------|--------|------|
| **未カバー** | KW数 = 0 | 赤（#fce4ec） | その地域に関連するKWが1つもない。コンテンツが存在しないか、全く検索にヒットしていない。 |
| **手薄** | KW数 = 1〜2 | オレンジ（#fff3e0） | KWはわずかにあるが、カバレッジが薄い。コンテンツの拡充が望ましい。 |
| **カバー済** | KW数 >= 3 | なし | 一定数のKWがあり、ある程度カバーできている。 |

### 出力カラム

| カラム | 説明 |
|--------|------|
| **都道府県** | 都道府県名 |
| **地方** | 所属する地方ブロック |
| **ステータス** | 未カバー / 手薄 / カバー済 |
| **キーワード数** | マッチしたKWの数 |

### 読み方のポイント

- **未カバー地域が自社のサービス対象エリアの場合**: 地域ページの新規作成を最優先で検討。
- **同じ地方内に未カバーと手薄が混在**: 近隣県のページを参考に横展開が効率的。
- **カバー済でもKW数が少ない場合**: 「都道府県別分析」シートで順位を確認し、既存コンテンツの強化を検討。

---

## 10. 順位帯別分布

各都道府県のキーワードが**どの順位帯に分布しているか**をクロス集計します。
KWが1件以上ある都道府県のみ表示され、合計の多い順にソートされています。

### 順位帯の定義

| 順位帯 | 範囲 | 意味 |
|--------|------|------|
| **1〜3位** | 順位 <= 3 | 検索結果のトップ。最もクリックされやすい。 |
| **4〜10位** | 3 < 順位 <= 10 | 1ページ目。ユーザーの目に留まる。 |
| **11〜20位** | 10 < 順位 <= 20 | 2ページ目。クリック率は大幅に低下するが、少しの改善で1ページ目に入れる可能性。 |
| **21〜50位** | 20 < 順位 <= 50 | 3〜5ページ目。コンテンツの大幅な改善が必要。 |
| **51位以下** | 順位 > 50 | ほぼ表示されない。コンテンツの存在は認識されているが、競争力が弱い。 |

### 出力カラム

| カラム | 説明 |
|--------|------|
| **都道府県** | 都道府県名 |
| **1〜3位** | その順位帯に入るKWの数 |
| **4〜10位** | 同上 |
| **11〜20位** | 同上 |
| **21〜50位** | 同上 |
| **51位以下** | 同上 |
| **合計** | 全順位帯のKW数合計 |

### 読み方のポイント

- **「11〜20位」が多い都道府県**: 最も改善効果が高い。少しの対策で1ページ目に入る可能性がある。
- **「1〜3位」が多い都道府県**: 既に強い。防衛的な対策（コンテンツ更新、被リンク維持）を行う。
- **「51位以下」ばかりの都道府県**: コンテンツの根本的な見直しが必要。

---

## 11. 地域×サービス マトリクス

都道府県とサービスキーワードの**組み合わせマトリクス**を表示します。
**設定シートでサービスキーワードを登録した場合のみ**出力されます。

### 出力カラム

| カラム | 説明 |
|--------|------|
| **都道府県** | 都道府県名 |
| **（サービスKW1）** | そのサービスKWを含むKWの数 |
| **（サービスKW2）** | 同上 |
| **...** | 設定シートに登録したKW分の列 |
| **その他地域KW** | どのサービスKWにもマッチしなかった地域KWの数 |

### セルの色分け

| 色 | 条件 | 意味 |
|----|------|------|
| 緑（濃） | 3件以上 | カバー済み |
| 緑（薄） | 1〜2件 | 存在するが手薄 |
| グレー | 0件 | 未カバー |

### 読み方のポイント

- **グレーのセル（0件）**: その「地域×サービス」の組み合わせのコンテンツが不足。ビジネスの対象であれば新規作成を検討。
- **例**: 「大阪 × ウォータージェット」が0件なら、大阪向けのウォータージェット加工ページが必要。
- **行方向（横）に見る**: ある都道府県がどのサービスをカバーしているか。
- **列方向（縦）に見る**: あるサービスがどの都道府県をカバーしているか。

---

## 12. 設定シート

「地域×サービス」マトリクス分析で使用するサービスキーワードを登録するシートです。

### 設定方法

1. メニュー「地域KW分析」→「設定シートを作成」をクリック
2. 「サービスキーワード」の見出しの下に、1行1キーワードで入力
3. 最後の行の下に `---`（区切り線）を残す

### 設定例

```
サービスキーワード
ウォータージェット
加工
切断
研磨
---
```

### 注意

- キーワードは**部分一致**で判定されます（「加工」は「ウォータージェット加工」にもマッチ）。
- 広すぎるキーワードは避けてください（例: 「の」「する」など）。
- 設定シートがない場合、マトリクス分析はスキップされます。

---

## 13. 用語解説

### GSC指標

| 用語 | 説明 |
|------|------|
| **クエリ（Query）** | ユーザーがGoogleで検索した文字列。 |
| **クリック数（Clicks）** | 検索結果からサイトへのクリック回数。 |
| **表示回数（Impressions）** | 検索結果にサイトが表示された回数。クリックされなくてもカウントされる。 |
| **CTR（Click Through Rate）** | クリック率。`クリック数 ÷ 表示回数`。検索結果からどの程度クリックされたか。 |
| **掲載順位（Position）** | Google検索結果での平均表示順位。1が最上位。小数点以下は期間中の変動を反映。 |

### 本スクリプト固有の用語

| 用語 | 説明 |
|------|------|
| **地域キーワード** | 都道府県名または主要都市名を含むと判定されたクエリ。 |
| **非地域キーワード** | 地域名を含まないクエリ。ブランド名や一般的なサービス名など。 |
| **加重平均順位** | 表示回数で重み付けした平均順位。表示が多いKWの影響をより強く反映する。 |
| **チャンススコア** | `表示回数 × (現在順位 - 3)`。改善した場合に見込めるインパクトの推定値。 |
| **CTRベンチマーク** | 順位帯ごとの業界平均CTR。実際のCTRと比較して改善余地を判定する基準値。 |

### 都道府県マッチングの仕組み

スクリプトは以下の辞書を使ってクエリを都道府県に分類します:

1. **都道府県名（フルネーム）**: 「東京都」「神奈川県」「大阪府」「北海道」「京都府」
2. **都道府県名（略称）**: 「東京」「神奈川」「大阪」「京都」
3. **主要都市名**: 「横浜」→神奈川県、「名古屋」→愛知県、「博多」→福岡県 など

合計 **200以上の地名** がマッチング辞書に登録されています。
長い文字列から優先的にマッチするため、「会津若松」は「若松」より先にマッチします。

---

## 14. 分析結果の活用方法

### ステップ1: 現状を把握する

1. **サマリー**で全体像を確認
   - 地域KW比率は何%か？
   - 47都道府県中、何県をカバーできているか？

### ステップ2: 強い地域・弱い地域を特定する

2. **都道府県別分析**でKW数と順位を確認
   - Top3に多くのKWがある県 = 強い地域
   - KW数が0または順位が悪い県 = 弱い地域

3. **未カバー地域**で赤（未カバー）とオレンジ（手薄）の県を確認

### ステップ3: 優先対応を決める

4. **チャンスKW**のスコア上位から対応
   - 表示回数が多い＝需要がある
   - 順位が低い＝改善の余地がある

5. **低CTR改善KW**でタイトル改善を検討
   - 順位はいいのにクリックされないKW
   - すぐに対応可能（コンテンツ変更不要でタイトルだけ変える）

### ステップ4: 新規コンテンツを計画する

6. **未カバー地域** + **地域×サービスマトリクス**を組み合わせて、どの「地域×サービス」の組み合わせのページを作るべきか決める

### ステップ5: 定期的に計測する

7. 月1回または四半期ごとにGSCデータをエクスポートし、同じ分析を実行
8. 各指標の推移を追い、対策の効果を検証

---

## 15. 注意事項と制限

### データに関する制限

| 項目 | 内容 |
|------|------|
| **GSCの上限** | Search Console標準のエクスポートは上位1,000クエリまで。外部ツール（Search Analytics for Sheets等）で1,000件以上取得した場合も、シート名とヘッダーが同じであれば正常に動作します。 |
| **期間** | エクスポートした期間のデータのみが分析対象。期間が短すぎると表示回数が少なく偏りが出ます。推奨は**過去3ヶ月**以上。 |
| **順位の精度** | GSCの掲載順位は期間中の平均値。日々変動しているため、あくまで目安です。 |

### マッチングに関する注意

| 項目 | 内容 |
|------|------|
| **誤マッチの可能性** | 「日立」が茨城県の日立市としてマッチするが、「日立製作所」を指している場合がある。「地域KW一覧」のマッチキーワード列で確認してください。 |
| **短い地名** | 「関」（岐阜県関市）のような短い文字列は他の文脈でもマッチする可能性があります。辞書は必要に応じてCode.gs内の `PREFECTURE_DICT` を編集してカスタマイズ可能です。 |
| **市区町村の網羅性** | 全市区町村ではなく主要都市のみを収録しています。必要に応じて辞書にcitiesを追加してください。 |

### 日本語/英語対応

以下のヘッダーに両対応しています:

| 日本語 | 英語 |
|--------|------|
| 上位のクエリ | Top queries / Queries / Query |
| クリック数 | Clicks |
| 表示回数 | Impressions |
| CTR | CTR |
| 掲載順位 | Position / Average position |

シート名は「クエリ」または「Queries」のいずれかに対応しています。

### CTRの読み取り

CTR列は以下のいずれの形式でも正しく処理されます:
- パーセント文字列: `"10.56%"`
- 小数値: `0.1056`
- 数値（100分率）: `10.56`（自動的に0.1056に変換）
